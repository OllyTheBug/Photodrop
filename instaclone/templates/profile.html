{% extends 'layout.html' %}


{% block content %}



<div class="columns">
    <div class="column is-three-fifths is-offset-one-fifth">
        <div class="card">
            <div class="card"></div>
            <!-- for each photo in photos, draw a card -->
            <style>
                .profile-card {
                    margin-top: 20px;
                }

                .crud-menu {
                    display: flex;
                    align-items: center;
                    padding: 4px;
                    border: 1px solid #ccc;
                    border-radius: 4px;
                    width: 35px;
                    text-align: center;
                    /* transition width */
                    transition: width 0.3s ease-in-out;
                    overflow: hidden;
                }

                /* .crud-menu hover */
                .crud-menu:hover {
                    width: 175px;
                }

                .menu-item {
                    margin-right: 20px;
                }
            </style>
            {% for photo in photos %}
            <!-- ----------- Modal for each photo that contains an edit form ----------- -->
            <div class="modal" id="modal{{loop.index0}}">
                <div class="modal-background"></div>
                <div class="modal-content">
                    <div class="modal-card">
                        <div class="modal-card-body">
                            <!-- Form to edit caption and private -->
                            <!-- ------------ Send the index of the photo in user document as a q string ------------- -->
                            <form method="post" action="{{photos[loop.index0]['url']}}?index={{loop.index0}}" enctype="application/json">
                                <div class="field">
                                    <label class="label">
                                        <p class="title" style="padding: 8px;">Edit Caption</p>
                                    </label>
                                    <div class="control">
                                        <textarea class="textarea" name="caption{{loop.index0}}"
                                            placeholder="Enter a caption">{{photo.caption}}</textarea>
                                    </div>
                                </div>
                                <div class="field">
                                    <label class="label">
                                        <p class="title" style="padding: 8px;">Private</p>
                                    </label>
                                    <div class="control">
                                        <label class="radio">
                                            <input type="radio" name="private{{loop.index0}}" value="private" {% if photo.private=='private'
                                                %}checked{% endif %}>
                                            Private
                                        </label>
                                        <label class="radio">
                                            <input type="radio" name="private{{loop.index0}}" value="public" {% if photo.private!='private'
                                                %}checked{% endif %}>
                                            Public
                                        </label>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="control">
                                        <button type="submit" class="button is-primary">Submit</button>
                                    </div>
                                </div>
                        </div>
                    </div>

                </div>
                <button class="modal-close is-large" aria-label="close"></button>
            </div>

            <div class="card profile-card">
                <div class="card-image">
                    <figure class="image is-4by3">
                        <img src="{{ photo.url }}" alt="{{ photo.caption }}">
                    </figure>
                </div>
                <div class="card-content">

                    <div class="title crud-menu" onclick="menuPop()">
                        <span class="menu-item material-symbols-outlined">
                            menu
                        </span>
                        <span class="menu-item material-symbols-outlined js-modal-trigger"
                            data-target="modal{{loop.index0}}">
                            edit
                        </span>
                        <a data-confirm="Are you sure?" data-method="delete" href="{{photo.url}}">
                            <span class="menu-item material-symbols-outlined">
                                delete
                            </span>
                        </a>
                        <span class="menu-item material-symbols-outlined">
                            link
                        </span>
                    </div>
                    <div class="media">


                        <div class="media-content">
                            <p class="title is-4">{{ user.name }}</p>
                            <p class="subtitle is-6">{{ photo.caption }}</p>
                        </div>
                        <br>

                    </div>



                </div>
                <hr>
                {% endfor %}
                <script>
                    function menuPop() {
                        var popup = document.getElementsByClassName("popuptext")[0];
                        //toggle between show and hide
                        popup.classList.toggle("show");

                    }
                    function openModal($el) {
                        $el.classList.add('is-active');
                    }
                    function closeModal($el) {
                        $el.classList.remove('is-active');
                    }
                    function closeAllModals() {
                        (document.querySelectorAll('.modal') || []).forEach(($modal) => {
                            closeModal($modal);
                        });
                    }
                    (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
                        const modal = $trigger.dataset.target;
                        const $target = document.getElementById(modal);

                        $trigger.addEventListener('click', () => {
                            openModal($target);
                        });
                    });
                    // Add a click event on various child elements to close the parent modal
                    (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
                        const $target = $close.closest('.modal');

                        $close.addEventListener('click', () => {
                            closeModal($target);
                        });
                    });
                </script>
            </div>
        </div>
    </div>

    {% endblock %}